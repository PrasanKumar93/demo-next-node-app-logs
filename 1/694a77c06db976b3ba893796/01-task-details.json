{
  "taskId": 1,
  "name": "make street address non mandatory in registration page",
  "createdAt": "2025-12-23T10:28:26.000Z",
  "updatedAt": "2025-12-23T11:06:15.000Z",
  "allAssignees": [
    "keshavjeet",
    "PrasanKumar93"
  ],
  "assignee": "PrasanKumar93",
  "taskStatus": "TODO",
  "taskCategory": "",
  "priority": "",
  "llmTaskExplanation": "Update the user registration flow so that the Street Address field (nested under `address.street`) is optional (non-mandatory) on the registration page in a Next.js (TypeScript) frontend and Express (TypeScript) backend using Zod for validation. This includes: (1) updating the UI form so it no longer marks `address.street` as required and does not block submission when empty; (2) updating client-side Zod validation/schema so `address.street` is optional and whitespace-only is treated as missing; (3) ensuring the backend registration endpoint accepts a missing/empty `address.street` without returning validation errors; (4) ensuring persistence layer (DB schema/model) allows null for street address; and (5) updating any shared types/contracts so `address.street` is not required. Normalize empty/whitespace-only street values to `null` consistently across client + API + DB.",
  "validations": [
    "Registration form can be submitted when `address.street` is empty/undefined.",
    "If `address.street` is provided, it must be a string and trimmed of leading/trailing whitespace before submission/persistence.",
    "`address.street` with only whitespace is treated as missing and normalized to `null` (and ideally omitted from the request payload).",
    "`address.street` length constraints: enforce existing max length if present; otherwise default to 255 chars.",
    "`address.street` may contain common address characters (letters, numbers, spaces, punctuation like . , - # /); do not over-restrict with an overly strict regex.",
    "Backend Zod validation must not require `address.street` for registration requests; missing field must not cause 400/422 errors.",
    "No other address fields are present/required on registration; only `address.street` behavior changes.",
    "Error messaging: no 'Street Address is required' message should appear when the field is empty.",
    "If there is a 'required' asterisk/label, it should be removed for Street Address only.",
    "Persistence: street address must be nullable in the DB/model; storing should be consistent (store `null` when missing/blank).",
    "If API docs/contracts exist (OpenAPI/TS types), `address.street` must not be listed as required."
  ],
  "unitTests": [
    "Frontend form validation (Next.js): submitting with `address.street` empty succeeds (no validation error shown).",
    "Frontend form validation: submitting with `address.street` provided and within max length succeeds.",
    "Frontend form validation: `address.street` with only whitespace is treated as empty and does not block submission; payload normalizes to `null`/omits the field.",
    "Frontend form validation: `address.street` exceeding max length shows an error (if max length validation exists/added).",
    "Backend request validation (Express + Zod): registration payload without `address.street` returns success (200/201) and creates user.",
    "Backend request validation: registration payload with `address.street` as empty string/whitespace is accepted and normalized to `null` per chosen behavior.",
    "Backend persistence: created user record has street address `null` when omitted/blank.",
    "Contract/type test: shared DTO/TS type/Zod schema marks `address.street` optional; OpenAPI (if present) does not include it in `required`."
  ],
  "acceptanceCriteria": [
    "Given I am on the registration page, when I leave Street Address blank and submit valid required fields, then registration succeeds and I am not shown a 'Street Address is required' error.",
    "Given I enter a Street Address, when I submit the form, then the value is trimmed and saved and is available in the created user profile/response.",
    "Given the registration API is called without `address.street`, when the request is otherwise valid, then the API responds successfully (no 4xx validation error).",
    "Given I enter only whitespace for Street Address, when I submit, then registration succeeds and the stored value is `null` (not an empty string).",
    "Given existing required fields (e.g., email/password/name) are missing/invalid, when I submit, then those validations still behave exactly as before (no regression).",
    "Given Street Address is blank, when the user record is created, then downstream pages that read/display the address do not break and handle `null` safely."
  ],
  "technicalDependencies": [
    "Frontend: Next.js + TypeScript",
    "Backend: Express + TypeScript",
    "Validation: Zod schemas on both client and server (or shared package if present)",
    "Use existing test runner/framework in the repo (e.g., Jest/Vitest) and existing API test tooling (e.g., supertest) if already used",
    "Use existing ORM/migration tooling if DB schema change is required (e.g., Prisma/TypeORM/Sequelize/Knex)"
  ],
  "security": [
    "Treat street address as PII: avoid logging raw `address.street` in application logs; ensure any request logging redacts PII.",
    "Server-side validation must still sanitize/normalize input (trim) and enforce max length to reduce abuse (oversized payloads).",
    "No change to authentication/authorization is expected for registration; ensure endpoint behavior remains consistent and does not expose additional user data in responses."
  ],
  "performance": [
    "No meaningful performance impact expected; keep validation lightweight (avoid heavy regex/backtracking).",
    "If adding DB migration to allow null, ensure migration is safe and does not lock tables excessively (use standard migration practices for the project)."
  ],
  "businessContext": "Users may not know or want to provide their street address during initial registration. Making `address.street` optional reduces friction and improves conversion while still allowing address collection when available. Since no downstream flows require an address immediately after registration, this change should not block any post-registration flow; ensure any consumers handle `null` safely.",
  "otherNotes": "Normalize `address.street` empty/whitespace-only to `null` consistently across frontend mapping, backend Zod parsing, and DB persistence. If the DB column is currently NOT NULL, add a migration to allow NULL and update any seed/test fixtures accordingly. Update UI copy/required indicators and any i18n keys if the label includes '(required)'. Update API documentation/contract (OpenAPI/TS types) so `address.street` is optional.",
  "llmAssumptions": [
    {
      "assumption": "Frontend is Next.js with TypeScript and uses Zod for registration form validation (directly or via a form library integration)."
    },
    {
      "assumption": "Backend is Express with TypeScript and uses Zod to validate the registration request body."
    },
    {
      "assumption": "Street Address is nested under an `address` object as `address.street` in both client payload and backend DTO."
    },
    {
      "assumption": "Preferred normalization is to convert empty/whitespace-only street values to `null` (and omit from payload when possible)."
    },
    {
      "assumption": "There are no other address fields on registration; only `address.street` exists and is being changed."
    },
    {
      "assumption": "There are no downstream flows that require an address immediately after registration."
    }
  ],
  "llmOpenQuestions": [
    {
      "question": "Which ORM/database is used (e.g., Prisma/TypeORM/Sequelize/Knex) and what is the exact column/path for street address in the DB schema (e.g., users.address_street vs JSON address)?",
      "answer":"mongodb with zod schema validation"
    },
    {
      "question": "Where is the shared contract defined (OpenAPI spec file path, shared types package, or server-only Zod schema) that needs updating for `address.street` optionality?",
      "answer":"let aider plan it"
    },
    {
      "question": "What test stack is used in this repo (Jest vs Vitest, React Testing Library, supertest), and where are existing registration tests located?",
      "answer":"let aider plan it"
    }
  ],
  "llmFileReferences": [],
  "inScope": [
    "Make Street Address (`address.street`) optional on the registration UI (required indicator + validation).",
    "Update client-side Zod schema/types so `address.street` is not required and whitespace-only normalizes to `null`.",
    "Update backend Zod validation/DTO so `address.street` is not required and whitespace-only normalizes to `null`.",
    "Update persistence layer to allow missing street address (including DB migration if needed) and store `null` when missing/blank.",
    "Update API documentation/contract/shared types so `address.street` is optional.",
    "Add/update unit tests to prevent regressions."
  ],
  "outOfScope": [
    "Removing the Street Address field entirely from the registration page.",
    "Adding other address fields (city/state/zip/country) to registration.",
    "Changing other required fields or redesigning the registration UX beyond required/optional behavior.",
    "Implementing new address verification/auto-complete services.",
    "Building a new 'complete your profile' flow (unless already present)."
  ],
  "suggestedFileChanges": [
    {
      "path": "src/pages/Register.tsx",
      "rationale": "Next.js registration page UI: remove required marker for Street Address and allow submit without `address.street` (path may differ)."
    },
    {
      "path": "src/components/RegistrationForm.tsx",
      "rationale": "If the form is a component, update field config, required indicator, and mapping/normalization for `address.street`."
    },
    {
      "path": "src/validation/registerSchema.ts",
      "rationale": "Client-side Zod schema: make `address.street` optional; trim; max length; normalize whitespace-only to undefined/null."
    },
    {
      "path": "src/api/auth.ts",
      "rationale": "Client request payload mapping: omit `address.street` when blank or send `null` consistently per API contract."
    },
    {
      "path": "server/routes/auth.ts",
      "rationale": "Express registration route: accept missing `address.street` and pass normalized data to service layer."
    },
    {
      "path": "server/validators/register.ts",
      "rationale": "Backend Zod schema/DTO: mark `address.street` optional and normalize empty/whitespace-only to `null`."
    },
    {
      "path": "server/models/User.ts",
      "rationale": "User model/type: ensure street address is nullable/optional and aligns with DB schema."
    },
    {
      "path": "server/migrations/XXXX_make_address_street_nullable.sql",
      "rationale": "DB migration to drop NOT NULL constraint / adjust column definition for street address if currently required."
    },
    {
      "path": "tests/registration.test.ts",
      "rationale": "Add/adjust tests for registration without `address.street`, whitespace normalization, and persistence behavior."
    }
  ],
  "promptForAider": "## Task: Make Street Address optional on registration (Next.js TS + Express TS + Zod)\n\nMake **Street Address** optional end-to-end. The field is **nested** as `address.street`.\n\n### Implement\n1. **Frontend (Next.js)**\n   - Remove required asterisk/label for Street Address.\n   - Update client Zod schema so `address.street` is optional.\n   - Normalize: trim; if empty/whitespace-only => treat as missing and send `null` or omit the field (prefer omit + server sets null).\n   - Enforce max length (use existing; otherwise 255).\n\n2. **Backend (Express + Zod)**\n   - Update registration request Zod schema/DTO so `address.street` is optional.\n   - Normalize: trim; empty/whitespace-only => `null`.\n   - Ensure route/service persists `null` and does not throw validation errors when missing.\n\n3. **DB/Model**\n   - Ensure street address column/path is nullable; add migration if currently NOT NULL.\n\n4. **Contracts**\n   - Update shared types/OpenAPI (wherever defined) so `address.street` is not required.\n\n### Key validations\n- Missing `address.street` allowed.\n- Whitespace-only => `null`.\n- If provided: trimmed string, <= 255.\n- No 'Street Address is required' error.\n\n### Tests\n- Frontend: submit with blank street succeeds; whitespace-only treated as blank.\n- Backend: POST /register without `address.street` succeeds; with empty/whitespace normalizes to null.\n- Persistence: stored value is null when omitted/blank.\n- Contract/type: `address.street` optional.\n\n### Suggested files (adjust to actual repo paths)\n- `src/pages/Register.tsx`\n- `src/components/RegistrationForm.tsx`\n- `src/validation/registerSchema.ts`\n- `src/api/auth.ts`\n- `server/routes/auth.ts`\n- `server/validators/register.ts`\n- `server/models/User.ts`\n- `server/migrations/*make_address_street_nullable*`\n- `tests/registration.test.ts`\n\n### Security\n- Treat street address as PII; avoid logging raw values; ensure request logging redacts it.\n"
}
